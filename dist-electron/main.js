"use strict";const n=require("electron"),c=require("path"),h=require("child_process"),u=require("fs"),g=require("http"),f=process.env.NODE_ENV!=="production"&&!n.app.isPackaged,p=process.env.NEXT_PORT||"3000";let l=null,s=null;function m(t,i=15e3){const a=Date.now();return new Promise((o,r)=>{(function e(){const d=g.request({hostname:"127.0.0.1",port:Number(t),path:"/",method:"HEAD",timeout:2e3},v=>{o()});d.on("error",()=>{Date.now()-a>i?r(new Error("Timed out waiting for server")):setTimeout(e,250)}),d.on("timeout",()=>{d.destroy(),Date.now()-a>i?r(new Error("Timed out waiting for server")):setTimeout(e,250)}),d.end()})()})}async function x(){if(f)return;const t=process.resourcesPath,a=[c.join(t,"next","standalone"),c.join(t,"standalone"),c.join(process.execPath,"..","next","standalone")];let o=null;for(const e of a)if(u.existsSync(e)){o=e;break}if(!o){console.error("Next standalone server not found. Tried:",a);return}const r=c.join(o,"server.js");if(!u.existsSync(r)){console.error("Next server.js not found at",r);return}l=h.fork(r,[],{env:{...process.env,PORT:p,NODE_ENV:"production"},cwd:o,stdio:["ignore","pipe","pipe","ipc"]}),l.stdout?.on?.("data",e=>{console.log("[next]",e.toString().trim())}),l.stderr?.on?.("data",e=>{console.error("[next err]",e.toString().trim())}),await m(p,2e4)}async function w(t="/"){s=new n.BrowserWindow({width:1200,height:800,webPreferences:{preload:c.join(__dirname,"preload.js"),nodeIntegration:!1,contextIsolation:!0,sandbox:!0}});const i=`http://127.0.0.1:${p}${t}`;await s.loadURL(i),s.webContents.on("did-start-loading",()=>{console.log("Electron loading URL:",s?.webContents.getURL())}),s.on("closed",()=>{s=null})}n.app.whenReady().then(async()=>{f||await x(),w(),n.app.on("activate",()=>{n.BrowserWindow.getAllWindows().length===0&&w()})});n.app.on("window-all-closed",()=>{if(l)try{l.kill()}catch{}process.platform!=="darwin"&&n.app.quit()});n.ipcMain.handle("ping",async()=>"pong from main");
